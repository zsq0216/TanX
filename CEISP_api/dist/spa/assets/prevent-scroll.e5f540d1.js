import{e as k,k as z,F as B,G as I,H as $,t as K,h as O,g as Q,q as j,P as D,x as E,K as _,a0 as G,a5 as m,L as f,a7 as U}from"./index.72b74f6b.js";import{c as J}from"./axios.1562a4a6.js";import{b as N,a as Z,h as ee}from"./scroll.7d6d8e83.js";var se=k({name:"QForm",props:{autofocus:Boolean,noErrorFocus:Boolean,noResetFocus:Boolean,greedy:Boolean,onSubmit:Function},emits:["reset","validationSuccess","validationError"],setup(e,{slots:t,emit:s}){const l=j(),i=z(null);let c=0;const r=[];function L(o){const d=typeof o=="boolean"?o:e.noErrorFocus!==!0,y=++c,V=(n,a)=>{s("validation"+(n===!0?"Success":"Error"),a)},F=n=>{const a=n.validate();return typeof a.then=="function"?a.then(u=>({valid:u,comp:n}),u=>({valid:!1,comp:n,err:u})):Promise.resolve({valid:a,comp:n})};return(e.greedy===!0?Promise.all(r.map(F)).then(n=>n.filter(a=>a.valid!==!0)):r.reduce((n,a)=>n.then(()=>F(a).then(u=>{if(u.valid===!1)return Promise.reject(u)})),Promise.resolve()).catch(n=>[n])).then(n=>{if(n===void 0||n.length===0)return y===c&&V(!0),!0;if(y===c){const{comp:a,err:u}=n[0];if(u!==void 0&&console.error(u),V(!1,a),d===!0){const A=n.find(({comp:H})=>typeof H.focus=="function"&&D(H.$)===!1);A!==void 0&&A.comp.focus()}}return!1})}function P(){c++,r.forEach(o=>{typeof o.resetValidation=="function"&&o.resetValidation()})}function T(o){o!==void 0&&E(o);const d=c+1;L().then(y=>{d===c&&y===!0&&(e.onSubmit!==void 0?s("submit",o):o!==void 0&&o.target!==void 0&&typeof o.target.submit=="function"&&o.target.submit())})}function q(o){o!==void 0&&E(o),s("reset"),_(()=>{P(),e.autofocus===!0&&e.noResetFocus!==!0&&h()})}function h(){J(()=>{if(i.value===null)return;const o=i.value.querySelector("[autofocus][tabindex], [data-autofocus][tabindex]")||i.value.querySelector("[autofocus] [tabindex], [data-autofocus] [tabindex]")||i.value.querySelector("[autofocus], [data-autofocus]")||Array.prototype.find.call(i.value.querySelectorAll("[tabindex]"),d=>d.tabIndex!==-1);o!=null&&o.focus({preventScroll:!0})})}B(G,{bindComponent(o){r.push(o)},unbindComponent(o){const d=r.indexOf(o);d!==-1&&r.splice(d,1)}});let C=!1;return I(()=>{C=!0}),$(()=>{C===!0&&e.autofocus===!0&&h()}),K(()=>{e.autofocus===!0&&h()}),Object.assign(l.proxy,{validate:L,resetValidation:P,submit:T,reset:q,focus:h,getValidationComponents:()=>r}),()=>O("form",{class:"q-form",ref:i,onSubmit:T,onReset:q},Q(t.default))}});let p=0,g,x,w,S=!1,M,R,W,v=null;function te(e){oe(e)&&E(e)}function oe(e){if(e.target===document.body||e.target.classList.contains("q-layout__backdrop"))return!0;const t=U(e),s=e.shiftKey&&!e.deltaX,l=!s&&Math.abs(e.deltaX)<=Math.abs(e.deltaY),i=s||l?e.deltaY:e.deltaX;for(let c=0;c<t.length;c++){const r=t[c];if(ee(r,l))return l?i<0&&r.scrollTop===0?!0:i>0&&r.scrollTop+r.clientHeight===r.scrollHeight:i<0&&r.scrollLeft===0?!0:i>0&&r.scrollLeft+r.clientWidth===r.scrollWidth}return!0}function X(e){e.target===document&&(document.scrollingElement.scrollTop=document.scrollingElement.scrollTop)}function b(e){S!==!0&&(S=!0,requestAnimationFrame(()=>{S=!1;const{height:t}=e.target,{clientHeight:s,scrollTop:l}=document.scrollingElement;(w===void 0||t!==window.innerHeight)&&(w=s-t,document.scrollingElement.scrollTop=l),l>w&&(document.scrollingElement.scrollTop-=Math.ceil((l-w)/8))}))}function Y(e){const t=document.body,s=window.visualViewport!==void 0;if(e==="add"){const{overflowY:l,overflowX:i}=window.getComputedStyle(t);g=N(window),x=Z(window),M=t.style.left,R=t.style.top,W=window.location.href,t.style.left=`-${g}px`,t.style.top=`-${x}px`,i!=="hidden"&&(i==="scroll"||t.scrollWidth>window.innerWidth)&&t.classList.add("q-body--force-scrollbar-x"),l!=="hidden"&&(l==="scroll"||t.scrollHeight>window.innerHeight)&&t.classList.add("q-body--force-scrollbar-y"),t.classList.add("q-body--prevent-scroll"),document.qScrollPrevented=!0,m.is.ios===!0&&(s===!0?(window.scrollTo(0,0),window.visualViewport.addEventListener("resize",b,f.passiveCapture),window.visualViewport.addEventListener("scroll",b,f.passiveCapture),window.scrollTo(0,0)):window.addEventListener("scroll",X,f.passiveCapture))}m.is.desktop===!0&&m.is.mac===!0&&window[`${e}EventListener`]("wheel",te,f.notPassive),e==="remove"&&(m.is.ios===!0&&(s===!0?(window.visualViewport.removeEventListener("resize",b,f.passiveCapture),window.visualViewport.removeEventListener("scroll",b,f.passiveCapture)):window.removeEventListener("scroll",X,f.passiveCapture)),t.classList.remove("q-body--prevent-scroll"),t.classList.remove("q-body--force-scrollbar-x"),t.classList.remove("q-body--force-scrollbar-y"),document.qScrollPrevented=!1,t.style.left=M,t.style.top=R,window.location.href===W&&window.scrollTo(g,x),w=void 0)}function ae(e){let t="add";if(e===!0){if(p++,v!==null){clearTimeout(v),v=null;return}if(p>1)return}else{if(p===0||(p--,p>0))return;if(t="remove",m.is.ios===!0&&m.is.nativeMobile===!0){v!==null&&clearTimeout(v),v=setTimeout(()=>{Y(t),v=null},100);return}}Y(t)}export{se as Q,ae as p};
